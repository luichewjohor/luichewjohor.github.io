"use strict";(self.webpackChunkluichewjohor=self.webpackChunkluichewjohor||[]).push([[797],{8797:(V,p,l)=>{l.r(p),l.d(p,{CommitteeModule:()=>B});var c=l(6895),d=l(4004),t=l(4650),w=l(5698);class q{constructor(n,e,i,s,r){this.images=r,this.header=n,this.key=s,this.seq=i,this.staffs=e}}var F=l(8646),x=l(2248);let g=(()=>{class o{constructor(e,i){this.db=e,this.uploadFileService=i,this.basePath="/committee",this.committeeRef=e.list(this.basePath)}storeCommittee(e,i){this.db.list(this.basePath).push(new q(e.header,e.staffs,e.seq,null,null)).then(s=>{const r=this.basePath+"/"+s.key;console.log(r),this.uploadFileService.upload(i,r,"images")})}getAll(){return this.committeeRef}getAllCommittee(){return this.committeeRef.snapshotChanges().pipe((0,w.q)(1),(0,d.U)(e=>e.map(i=>({key:i.payload.key,...i.payload.val()}))),(0,d.U)(e=>e.sort((i,s)=>i.seq.localeCompare(s.seq))))}getCommittee(e){return this.db.object(this.basePath+"/"+e)}deleteCommitteeDatabase(e){return this.db.list(this.basePath+"/"+e).remove()}deleteCommittee(e){this.deleteCommitteeDatabase(e).catch(i=>console.log(i)),this.uploadFileService.deleteFileStorage(e,this.basePath),console.log("Deleted ID"+e)}updateCommittee(e,i){this.db.list(this.basePath).update(e,i)}updateCommitteeSeq(e){for(let i of e)this.db.list(this.basePath).update(i.key,{seq:i.seq})}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(F.KQ),t.LFG(x.I))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var u=l(1779),C=l(5087);function A(o,n){if(1&o&&(t.TgZ(0,"div",6),t._UZ(1,"img",7),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.s9C("alt",e.name),t.Q6J("src",e.url,t.LSH)}}const y=function(o,n){return{"flex-item-half":o,"flex-item-full":n}},T=function(o,n){return{w1:o,w3:n}},S=function(o,n){return{w2:o,w4:n}};function O(o,n){if(1&o&&(t.TgZ(0,"div",10)(1,"div",10)(2,"strong"),t._uU(3),t.qZA()(),t.TgZ(4,"div",10),t._uU(5),t.qZA()()),2&o){const e=n.$implicit,i=t.oxw().$implicit;t.Q6J("ngClass",t.WLB(5,y,i.staff.length>1,1===i.staff.length)),t.xp6(1),t.Q6J("ngClass",t.WLB(8,T,i.staff.length>1,1===i.staff.length)),t.xp6(2),t.Oqu(e.position),t.xp6(1),t.Q6J("ngClass",t.WLB(11,S,i.staff.length>1,1===i.staff.length)),t.xp6(1),t.hij(" :\xa0 ",e.name," ")}}function N(o,n){if(1&o&&(t.TgZ(0,"div",8),t.YNc(1,O,6,14,"div",9),t.qZA()),2&o){const e=n.$implicit;t.xp6(1),t.Q6J("ngForOf",e.staff)}}const U=function(o){return[o]};let E=(()=>{class o{constructor(e){this.authService=e,this.user=null}ngOnInit(){this.user=null,this.user=this.authService.getCurrentUser(),console.log(this.user)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(C.e))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-committee-detail"]],inputs:{committee:"committee"},decls:11,vars:8,consts:[["routerLinkActive","active",1,"list-group-item","clearfix",3,"routerLink"],[1,"container-fluid"],[1,"row"],["class","col-12","style","margin-bottom: 10px;",4,"ngFor","ngForOf"],[1,"col-12"],["class","flex-container",4,"ngFor","ngForOf"],[1,"col-12",2,"margin-bottom","10px"],[1,"img-fluid",3,"src","alt"],[1,"flex-container"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(e,i){1&e&&(t.TgZ(0,"a",0)(1,"div",1)(2,"div",2),t.YNc(3,A,2,2,"div",3),t.qZA(),t.TgZ(4,"div",2)(5,"div",4)(6,"p")(7,"strong"),t._uU(8),t.qZA()()()(),t.TgZ(9,"div",2),t.YNc(10,N,2,1,"div",5),t.qZA()()()),2&e&&(t.ekj("disabled",null==i.user),t.Q6J("routerLink",t.VKq(6,U,i.committee.key)),t.xp6(3),t.Q6J("ngForOf",i.committee.images),t.xp6(5),t.Oqu(i.committee.header),t.xp6(2),t.Q6J("ngForOf",i.committee.staffs))},dependencies:[c.mk,c.sg,u.rH,u.Od],styles:["a[_ngcontent-%COMP%]{margin-bottom:30px;cursor:pointer}a.disabled[_ngcontent-%COMP%]{pointer-events:none;cursor:not-allowed}.flex-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.flex-item-half[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;flex:50%;width:50%}.flex-item-full[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;flex:100%;width:100%}.w1[_ngcontent-%COMP%]{width:20%}.w2[_ngcontent-%COMP%]{width:80%}.w3[_ngcontent-%COMP%]{width:10%}.w4[_ngcontent-%COMP%]{width:90%}"]}),o})();function J(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onNewCommittee())}),t._uU(2,"\u6dfb\u52a0\u7406\u4e8b\u5e16"),t.qZA()()}}function k(o,n){1&o&&t._UZ(0,"app-committee-detail",7),2&o&&t.Q6J("committee",n.$implicit)}let v=(()=>{class o{constructor(e,i,s,r){this.committeeService=e,this.router=i,this.route=s,this.authService=r,this.committee=[],this.user=null}ngOnDestroy(){this.subscription.unsubscribe()}ngOnInit(){this.retrieveCommittee()}retrieveCommittee(){this.subscription=this.committeeService.getAll().snapshotChanges().pipe((0,d.U)(e=>e.map(i=>({key:i.payload.key,...i.payload.val()})))).subscribe(e=>{e.sort((i,s)=>s.seq.localeCompare(i.seq)),this.committee=e,this.user=this.authService.getCurrentUser(),console.log(this.committee)})}onNewCommittee(){this.router.navigate(["new"],{relativeTo:this.route})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(g),t.Y36(u.F0),t.Y36(u.gz),t.Y36(C.e))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-committee-list"]],decls:7,vars:2,consts:[["class","col-xs-12",4,"ngIf"],[1,"row"],[1,"col-sm-12"],["src","assets/img/CommitteeHeaderLogo.png","alt","CommitteeHeaderLogo",1,"img-responsive"],[3,"committee",4,"ngFor","ngForOf"],[1,"col-xs-12"],[1,"btn","btn-success",3,"click"],[3,"committee"]],template:function(e,i){1&e&&(t.YNc(0,J,3,0,"div",0),t.TgZ(1,"div",1)(2,"div",2)(3,"div"),t._UZ(4,"img",3),t.qZA(),t.TgZ(5,"div",1),t.YNc(6,k,1,1,"app-committee-detail",4),t.qZA()()()),2&e&&(t.Q6J("ngIf",null!=i.user),t.xp6(6),t.Q6J("ngForOf",i.committee))},dependencies:[c.sg,c.O5,E]}),o})();var M=l(5861),m=l(433),_=l(5843),I=l(8505);function P(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",26),t._UZ(2,"img",27),t.qZA(),t.TgZ(3,"div",28)(4,"button",5),t.NdJ("click",function(){const r=t.CHM(e).index,a=t.oxw();return t.KtG(a.onDeleteImage(r))}),t.TgZ(5,"span",29),t._uU(6," \u5220\u9664\u6b64\u56fe"),t.qZA()()(),t.TgZ(7,"label"),t._uU(8),t.qZA()()}if(2&o){const e=n.$implicit,i=n.index;t.xp6(1),t.Q6J("formGroupName",i),t.xp6(1),t.Q6J("src",e.value.result,t.LSH)("alt",e.value.name),t.xp6(6),t.hij(" ",e.value.name,"")}}function D(o,n){if(1&o&&(t.TgZ(0,"option",30),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e.seq),t.xp6(1),t.Oqu(e.seq)}}function Q(o,n){1&o&&(t.TgZ(0,"div",31)(1,"sup"),t._uU(2,"*"),t.qZA(),t._uU(3,"Please select your seq "),t.qZA())}function L(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div",40)(1,"div",41)(2,"div",42)(3,"label",43),t._uU(4,"\u804c\u4f4d"),t.qZA(),t._UZ(5,"input",44),t.qZA(),t.TgZ(6,"div",45)(7,"label",46),t._uU(8,"\u59d3\u540d"),t.qZA(),t._UZ(9,"input",47),t.qZA(),t.TgZ(10,"div",48)(11,"button",5),t.NdJ("click",function(){const r=t.CHM(e).index,a=t.oxw().index,f=t.oxw();return t.KtG(f.onDeleteStaffRow(a,r))}),t.TgZ(12,"span",29),t._uU(13," \u5220\u9664"),t.qZA()()()()()}2&o&&t.Q6J("formGroupName",n.index)}function G(o,n){if(1&o){const e=t.EpF();t.TgZ(0,"div")(1,"div",2)(2,"button",25),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().index,r=t.oxw();return t.KtG(r.onAddStaffColumn(s))}),t._uU(3," \u52a0\u884c "),t.qZA()()()}}function Y(o,n){if(1&o&&(t.TgZ(0,"div",32)(1,"div",33)(2,"label",34),t._uU(3,"\u6392"),t.qZA(),t._UZ(4,"input",35),t.qZA(),t.TgZ(5,"div",2)(6,"label",36),t._uU(7,"\u7b2c "),t.TgZ(8,"strong"),t._uU(9),t.qZA(),t._uU(10," \u6392"),t.qZA()(),t.TgZ(11,"div",37),t.YNc(12,L,14,1,"div",38),t.qZA(),t.YNc(13,G,4,0,"div",39),t.qZA()),2&o){const e=n.index,i=t.oxw();t.Q6J("formGroupName",e),t.xp6(1),t.Q6J("hidden",!0),t.xp6(3),t.Q6J("value",e),t.xp6(5),t.Oqu(e),t.xp6(3),t.Q6J("ngForOf",i.staffControls(e).controls),t.xp6(1),t.Q6J("ngIf",i.staffControls(e).controls.length<2)}}let b=(()=>{class o{constructor(e,i,s,r){this.fb=e,this.committeeService=i,this.route=s,this.router=r,this.editMode=!1,this.images=[],this.image="",this.isDisabled=!0,this.committee=[],this.user=null,this.isLoading=!1}ngOnDestroy(){this.subscription.unsubscribe()}ngOnInit(){this.currentSeq="0",this.image="",this.images=[],this.committee=[],this.editMode=!1,this.isLoading=!0,this.route.params.subscribe(e=>{this.id=e.id,this.editMode=null!=e.id,this.initForm()})}initForm(){let e;this.committeeForm=this.fb.group({images:this.fb.array([]),header:new m.NI("",m.kI.required),seq:"0",staffs:this.fb.array([this.newStaffGrp(0)])}),this.images=[],this.editMode?this.committeeService.getCommittee(this.id).snapshotChanges().pipe((0,I.b)(i=>console.debug(i)),(0,d.U)(i=>({key:i.payload.key,...i.payload.val()}))).subscribe(i=>{e=i,this.updateForm(e)}):this.staffControls(0).push(this.newStaff()),this.subscription=this.committeeService.getAllCommittee().subscribe(i=>{this.committee=i,console.log(this.committee),this.editMode||(this.committee.push({key:"",header:"",images:[],seq:this.committee.length.toString(),staffs:[]}),this.seq.setValue((this.committee.length-1).toString()),this.currentSeq=(this.committee.length-1).toString())})}updateForm(e){if(e.header&&this.committeeForm.get("header").patchValue(e.header),e.images)for(let i of e.images)this.uploadExistingFile(i,"images");e.staffs&&(this.staffsControls.clear(),e.staffs.forEach(i=>{const s=+i.row;this.staffsControls.push(this.newStaffGrp(s)),i.staff.forEach(r=>{const a=this.newStaff();a.patchValue(r),this.staffControls(s).push(a)})})),this.seq.setValue(e.seq),this.currentSeq=e.seq}changeSeq(e){this.seq.setValue(e.target.value)}get seq(){return this.committeeForm.get("seq")}get imagesControls(){return this.committeeForm&&this.committeeForm.get("images")?this.committeeForm.get("images").controls:new m.Oe([])}onDeleteImage(e){this.committeeForm.get("images").removeAt(e),this.images.splice(e,1),this.image=this.images.map(i=>i.name).join(",")}get staffsControls(){return this.committeeForm&&this.committeeForm.get("staffs")?this.committeeForm.get("staffs"):new m.Oe([])}staffControls(e){return this.committeeForm&&this.staffsControls.at(e).get("staff")?this.staffsControls.at(e).get("staff"):new m.Oe([])}uploadCommiteeFile(e){let i=e.target.files;if(i){for(let r of i){let a=new FileReader;this.images.push(new _.p(r,r.type,r.name)),a.onload=f=>{this.createImage(f.target.result,r.name,"images")},a.readAsDataURL(r)}this.image=this.images.map(r=>r.name).join(",")}}createImage(e,i,s){this.committeeForm.get(s).push(new m.cw({result:new m.NI(e,m.kI.required),name:new m.NI(i,m.kI.required)}))}getBase64ImageFromUrl(e,i,s){var r=this;return(0,M.Z)(function*(){let f=yield(yield fetch(e)).blob();return new Promise((R,H)=>{let h=new FileReader;h.addEventListener("load",function(){R(h.result)},!1),h.onerror=()=>H(r),h.readAsDataURL(f),r.images.push(new _.p(new File([f],i),s,i,e)),r.image=r.images.map(K=>K.name).join(",")})})()}uploadExistingFile(e,i){this.getBase64ImageFromUrl(e.url,e.name,e.type).then(s=>this.createImage(s,e.name,i)).catch(s=>console.error(s))}newStaff(){return this.fb.group({position:new m.NI("",m.kI.required),name:new m.NI("",m.kI.required)})}newStaffGrp(e){return this.fb.group({row:new m.NI(e),staff:this.fb.array([])})}onDeleteStaffRow(e,i){console.log(e),this.staffControls(e).removeAt(i),0===i&&this.staffsControls.removeAt(e)}onAddStaffColumn(e){this.staffControls(e).controls.length>=2?this.onAddStaffRow():this.staffControls(e).push(this.newStaff())}onAddStaffRow(){const e=this.staffsControls.length-1+1;this.staffsControls.push(this.newStaffGrp(e)),this.staffControls(e).push(this.newStaff())}onSubmit(){let e=this.committeeForm.value;e=this.syncSeq(e),console.log(e),this.editMode&&(this.currentSeq!=e.seq&&this.exchangeSeq(e.seq),this.committeeService.deleteCommittee(this.id)),this.committeeService.storeCommittee(e,this.images),setTimeout(()=>{this.onCancel()},2e3)}syncSeq(e){let i=0;return e.staffs.forEach(s=>{e.staffs[i].row=i,i++}),e}exchangeSeq(e){let i=this.committee.find(r=>r.seq==e),s=i.key;i.seq=this.currentSeq,i.key=null,this.committeeService.updateCommittee(s,i)}onCancel(){this.image="",this.images=[],this.editMode=!1,this.router.navigate(["../"],{relativeTo:this.route})}onDelete(){this.committeeService.deleteCommittee(this.id),this.syncCommitteeSeq(),this.onCancel()}syncCommitteeSeq(){const e=this.committee.filter(s=>s.key!==this.id);let i=0;e.forEach(s=>{s.seq=i.toString(),i++}),this.committeeService.updateCommitteeSeq(e)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(m.qu),t.Y36(g),t.Y36(u.gz),t.Y36(u.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-committee-edit"]],decls:51,vars:9,consts:[[1,"wrapper"],[1,"row"],[1,"col-12"],[3,"formGroup","ngSubmit"],["type","submit",1,"btn","btn-success",3,"disabled"],["type","button",1,"btn","btn-danger",3,"click"],["formArrayName","images",1,"row"],["class","row",4,"ngFor","ngForOf"],[1,"col-2"],["type","button",1,"btn","btn-primary",2,"width","50%",3,"click"],[1,"col-10","mt-auto"],["id","image","type","file","accept",".gif,.bmp, .png, .jpeg, .jpg, .pdf","multiple","","name","image",3,"hidden","change"],["committeeFileUploader",""],[1,"col-1"],["for","header"],[1,"col-7"],[1,"form-group"],["type","text","id","header","formControlName","header",1,"form-control"],["for","seq"],["aria-label",".form-select-md example","formControlName","seq","id","seq",1,"form-select","form-select-md","mb-3",3,"change"],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["formArrayName","staffs",1,"col-12"],["for","staffs"],["class","row",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-success",3,"click"],[1,"col-6",3,"formGroupName"],[1,"img",3,"src","alt"],[1,"col-3","delete"],["id","boot-icon",1,"bi","bi-trash",2,"color","rgb(255,255,255)"],[3,"value"],[1,"invalid-feedback"],[1,"row",3,"formGroupName"],[1,"form-group",3,"hidden"],["for","row"],["type","number","id","row","formControlName","row",1,"form-control",3,"value"],["for","text"],["formArrayName","staff",1,"table"],["class","inner-table",3,"formGroupName",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"inner-table",3,"formGroupName"],[1,"inner","row"],[1,"col-3"],["for","position"],["type","text","id","position","formControlName","position",1,"form-control"],[1,"col-6"],["for","name"],["type","text","id","name","formControlName","name",1,"form-control"],[1,"col-3","mt-auto"]],template:function(e,i){if(1&e){const s=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3),t.NdJ("ngSubmit",function(){return i.onSubmit()}),t.TgZ(4,"div",1)(5,"div",2)(6,"button",4),t._uU(7," \u5b58\u6863 "),t.qZA(),t.TgZ(8,"button",5),t.NdJ("click",function(){return i.onCancel()}),t._uU(9," \u53d6\u6d88 "),t.qZA(),t.TgZ(10,"button",5),t.NdJ("click",function(){return i.onDelete()}),t._uU(11," \u5220\u9664\u6b64\u5e16 "),t.qZA()()(),t.TgZ(12,"div",6)(13,"label"),t._uU(14,"\u56fe\u7247"),t.qZA(),t.YNc(15,P,9,4,"div",7),t.qZA(),t.TgZ(16,"div",1)(17,"div",8)(18,"button",9),t.NdJ("click",function(){t.CHM(s);const a=t.MAs(24);return a.value="",t.KtG(a.click())}),t._uU(19," \u6e38\u89c8 "),t.qZA()(),t.TgZ(20,"div",10)(21,"span"),t._uU(22),t.qZA()()(),t.TgZ(23,"input",11,12),t.NdJ("change",function(a){return i.uploadCommiteeFile(a)}),t.qZA(),t.TgZ(25,"div",1)(26,"div",13)(27,"label",14),t._uU(28,"\u6807\u9898"),t.qZA()(),t.TgZ(29,"div",15)(30,"div",16),t._UZ(31,"input",17),t.qZA()()(),t.TgZ(32,"div",1)(33,"div",13)(34,"label",18),t._uU(35,"\u6b21\u5e8f"),t.qZA()(),t.TgZ(36,"div",15)(37,"select",19),t.NdJ("change",function(a){return i.changeSeq(a)}),t.YNc(38,D,2,2,"option",20),t.qZA()(),t.YNc(39,Q,4,0,"div",21),t.qZA(),t.TgZ(40,"div",1)(41,"div",22)(42,"label",23)(43,"h3")(44,"strong"),t._uU(45,"\u8463\u4e8b\u4f1a\u540d\u5355"),t.qZA()()(),t.YNc(46,Y,14,6,"div",24),t.qZA()(),t.TgZ(47,"div",1)(48,"div",2)(49,"button",25),t.NdJ("click",function(){return i.onAddStaffRow()}),t._uU(50," \u52a0\u6392 "),t.qZA()()()()()()()}2&e&&(t.xp6(3),t.Q6J("formGroup",i.committeeForm),t.xp6(3),t.Q6J("disabled",!i.committeeForm.valid),t.xp6(9),t.Q6J("ngForOf",i.imagesControls),t.xp6(7),t.AsE(" ",i.images.length," files have been uploaded ( ",i.image," ) "),t.xp6(1),t.Q6J("hidden",!0),t.xp6(15),t.Q6J("ngForOf",i.committee),t.xp6(1),t.Q6J("ngIf",null==i.seq.errors?null:i.seq.errors.required),t.xp6(7),t.Q6J("ngForOf",i.staffsControls.controls))},dependencies:[c.sg,c.O5,m._Y,m.YN,m.Kr,m.Fj,m.wV,m.EJ,m.JJ,m.JL,m.sg,m.u,m.x0,m.CE],styles:[".wrapper[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:absolute;z-index:1002;background-color:#02000080;width:100%;height:100%}.spinner-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;justify-items:center}.table[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.inner-table[_ngcontent-%COMP%]{width:50%}.inner[_ngcontent-%COMP%]{flex-basis:50%;flex-grow:1}.img[_ngcontent-%COMP%]{object-fit:cover;width:100%;height:100%}.delete[_ngcontent-%COMP%]{flex:1;display:flex;align-items:center;min-height:50px}.row[_ngcontent-%COMP%]{margin-bottom:10px}.col-12[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:20px}"]}),o})();var j=l(4466),Z=l(9363);let B=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[c.ez,m.u5,u.Bz.forChild([{path:"list",component:v},{path:"list/new",component:b,canActivate:[Z.a]},{path:"list/:id",component:b,canActivate:[Z.a]},{path:"",component:v}]),j.m]}),o})()}}]);