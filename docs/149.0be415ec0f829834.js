"use strict";(self.webpackChunkluichewjohor=self.webpackChunkluichewjohor||[]).push([[149],{2149:(K,v,a)=>{a.r(v),a.d(v,{CultureModule:()=>H});var d=a(6895),l=a(433),c=a(1779),A=a(4466),I=a(5861),h=a(5843),w=a(8505),m=a(4004);class b{constructor(o,t,i,s,u,n){this.header=o,this.headerImage=u,this.description=t,this.images=s,this.key=n,this.seq=i}}var e=a(4650);class _{constructor(o,t,i){this.path=o,this.fileList=t,this.attribute=i}}var x=a(5698),S=a(8646),L=a(2248);let F=(()=>{class r{constructor(t,i){this.db=t,this.uploadFileService=i,this.basePath="/culture",this.fileUploadFirebaseLst=[],this.cultureRef=t.list(this.basePath)}storeCulture(t,i,s){this.fileUploadFirebaseLst=[],this.db.list(this.basePath).push(new b(t.header,t.description,t.seq,[],[],null)).then(u=>{const n=this.basePath+"/"+u.key;this.fileUploadFirebaseLst.push(new _(n,i,"images")),this.fileUploadFirebaseLst.push(new _(n,s,"headerImage")),console.log(n),this.uploadFileService.uploadFileList(this.fileUploadFirebaseLst)})}getAll(){return this.cultureRef}getAllCulture(){return this.cultureRef.snapshotChanges().pipe((0,x.q)(1),(0,m.U)(t=>t.map(i=>({key:i.payload.key,...i.payload.val()}))),(0,m.U)(t=>t.sort((i,s)=>i.seq.localeCompare(s.seq))))}getCulture(t){return this.db.object(this.basePath+"/"+t)}deleteCultureDatabase(t){return this.db.list(this.basePath+"/"+t).remove()}deleteCulture(t){this.deleteCultureDatabase(t).catch(i=>console.log(i)),this.uploadFileService.deleteFileStorage(t,this.basePath),console.log("Deleted ID"+t)}updateCulture(t,i){this.db.list(this.basePath).update(t,i)}updateCultureSeq(t){for(let i of t)this.db.list(this.basePath).update(i.key,{seq:i.seq})}}return r.\u0275fac=function(t){return new(t||r)(e.LFG(S.KQ),e.LFG(L.I))},r.\u0275prov=e.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function U(r,o){if(1&r&&(e.TgZ(0,"div",28)(1,"div",29),e._UZ(2,"img",30),e.TgZ(3,"label"),e._uU(4),e.qZA()()()),2&r){const t=o.$implicit,i=o.index;e.xp6(1),e.Q6J("formGroupName",i),e.xp6(1),e.Q6J("src",t.value.result,e.LSH),e.xp6(2),e.hij(" ",t.value.name,"")}}function N(r,o){if(1&r&&(e.TgZ(0,"option",31),e._uU(1),e.qZA()),2&r){const t=o.$implicit;e.Q6J("value",t.seq),e.xp6(1),e.Oqu(t.seq)}}function J(r,o){1&r&&(e.TgZ(0,"div",32)(1,"sup"),e._uU(2,"*"),e.qZA(),e._uU(3,"Please select your seq "),e.qZA())}function O(r,o){if(1&r&&(e.TgZ(0,"div",28)(1,"div",29),e._UZ(2,"img",30),e.TgZ(3,"label"),e._uU(4),e.qZA()()()),2&r){const t=o.$implicit,i=o.index;e.xp6(1),e.Q6J("formGroupName",i),e.xp6(1),e.Q6J("src",t.value.result,e.LSH),e.xp6(2),e.hij(" ",t.value.name,"")}}function k(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"div",33)(1,"div",34)(2,"div",35),e._UZ(3,"textarea",36),e.qZA(),e.TgZ(4,"div",37)(5,"button",38),e.NdJ("click",function(){const u=e.CHM(t).index,n=e.oxw();return e.KtG(n.onDeleteParagraph(u))}),e.TgZ(6,"span",39),e._uU(7," Delete"),e.qZA()()()()()}2&r&&e.Q6J("formGroupName",o.index)}let Z=(()=>{class r{constructor(t,i,s){this.cultureService=t,this.route=i,this.router=s,this.editMode=!1,this.imageList=[],this.image="",this.headerImgLst=[],this.headerImg="",this.culture=[]}ngOnInit(){this.route.params.subscribe(t=>{this.id=t.id,this.editMode=null!=t.id,this.initForm()})}ngOnDestroy(){}onSubmit(){let t=this.cultureForm.value;this.editMode&&(this.currentSeq!=t.seq&&this.exchangeSeq(t.seq),this.cultureService.deleteCulture(this.id)),this.cultureService.storeCulture(t,this.imageList,this.headerImgLst),setTimeout(()=>{this.onCancel()},2e3)}onCancel(){this.image="",this.imageList=[],this.editMode=!1,this.culture=[],this.currentSeq="",this.headerImg="",this.headerImgLst=[],this.router.navigate(["../"],{relativeTo:this.route})}get descriptionsControls(){if(this.cultureForm&&this.cultureForm.get("description"))return this.cultureForm.get("description").controls}onAddParagraph(){this.cultureForm.get("description").push(new l.cw({paragraph:new l.NI(null,l.kI.required)}))}onDeleteParagraph(t){this.cultureForm.get("description").removeAt(t)}get imagesControls(){if(this.cultureForm&&this.cultureForm.get("images"))return this.cultureForm.get("images").controls}get headerImageControls(){if(this.cultureForm&&this.cultureForm.get("headerImage"))return this.cultureForm.get("headerImage").controls}createImage(t,i,s){this.cultureForm.get(s).push(new l.cw({result:new l.NI(t,l.kI.required),name:new l.NI(i,l.kI.required)}))}uploadCultureFile(t,i){let s=t.target.files;const u=i?"headerImage":"images";if(s){for(let n of s){i?this.headerImgLst.push(new h.p(n,n.type,n.name)):this.imageList.push(new h.p(n,n.type,n.name));let f=new FileReader;f.onload=p=>{this.createImage(p.target.result,n.name,u)},f.readAsDataURL(n)}this.image=this.imageList.map(n=>n.name).join(","),this.headerImg=this.headerImgLst.map(n=>n.name).join(",")}}getBase64ImageFromUrl(t,i,s,u){var n=this;return(0,I.Z)(function*(){let p=yield(yield fetch(t)).blob();return new Promise((z,B)=>{let g=new FileReader;g.addEventListener("load",function(){z(g.result)},!1),g.onerror=()=>B(n),g.readAsDataURL(p),u?n.headerImgLst.push(new h.p(new File([p],i),s,i,t)):n.imageList.push(new h.p(new File([p],i),s,i,t)),n.image=n.imageList.map(C=>C.name).join(","),n.headerImg=n.headerImgLst.map(C=>C.name).join(",")})})()}uploadExistingFile(t,i,s){this.getBase64ImageFromUrl(t.url,t.name,t.type,s).then(u=>this.createImage(u,t.name,i)).catch(u=>console.error(u))}initForm(){let t;this.cultureForm=new l.cw({header:new l.NI("",l.kI.required),headerImage:new l.Oe([]),images:new l.Oe([]),description:new l.Oe([]),seq:new l.NI("0",l.kI.required)}),this.imageList=[],this.editMode&&this.cultureService.getCulture(this.id).snapshotChanges().pipe((0,w.b)(i=>console.debug(i)),(0,m.U)(i=>({key:i.payload.key,...i.payload.val()}))).subscribe(i=>{t=i,this.updateForm(t)}),this.subscription=this.cultureService.getAllCulture().subscribe(i=>{this.culture=i,this.editMode||(this.culture.push(new b("",[],this.culture.length.toString())),this.seq.setValue((this.culture.length-1).toString()),this.currentSeq=(this.culture.length-1).toString())})}changeSeq(t){this.seq.setValue(t.target.value)}get seq(){return this.cultureForm.get("seq")}updateForm(t){if(t.description)for(let i of t.description)this.cultureForm.get("description").push(new l.cw({paragraph:new l.NI(i.paragraph,l.kI.required)}));if(t.images)for(let i of t.images)this.uploadExistingFile(i,"images",!1);if(t.header&&this.cultureForm.get("header").patchValue(t.header),t.headerImage)for(let i of t.headerImage)this.uploadExistingFile(i,"headerImage",!0);this.seq.setValue(t.seq),this.currentSeq=t.seq}exchangeSeq(t){let i=this.culture.find(u=>u.seq==t),s=i.key;i.seq=this.currentSeq,i.key=null,console.log(i),this.cultureService.updateCulture(s,i)}onDelete(){this.cultureService.deleteCulture(this.id),this.syncCultureSeq(),this.onCancel()}syncCultureSeq(){const t=this.culture.filter(s=>s.key!==this.id);let i=0;t.forEach(s=>{s.seq=i.toString(),i++}),this.cultureService.updateCultureSeq(t)}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(F),e.Y36(c.gz),e.Y36(c.F0))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-culture-edit"]],decls:58,vars:13,consts:[[1,"row"],[1,"col-12"],[3,"formGroup","ngSubmit"],["type","submit",1,"btn","btn-success",3,"disabled"],["type","button",1,"btn","btn-danger",3,"click"],["formArrayName","headerImage",1,"container"],["for","headerImage"],["class","col-3",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-primary",3,"click"],["id","image","type","file","accept",".png, .jpeg,.jpg","name","image","multiple","",3,"hidden","change"],["cultureHeaderImageUploader",""],[1,"form-group"],["for","header"],["type","text","id","header","formControlName","header",1,"form-control"],[1,"col-1"],["for","seq"],[1,"col-7"],["aria-label",".form-select-md example","formControlName","seq","id","seq",1,"form-select","form-select-md","mb-3",3,"change"],[3,"value",4,"ngFor","ngForOf"],["class","invalid-feedback",4,"ngIf"],["formArrayName","images",1,"container"],["for","images"],["id","image","type","file","accept",".gif,.bmp, .png, .jpeg, .jpg, .pdf","name","image","multiple","",3,"hidden","change"],["cultureFileUploader",""],["formArrayName","description",1,"col-12"],["for","description"],["class","row","style","margin-top: 10px",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-success",3,"click"],[1,"col-3"],[3,"formGroupName"],[1,"img-responsive",2,"height","100%","width","100%","object-fit","contain",3,"src"],[3,"value"],[1,"invalid-feedback"],[1,"row",2,"margin-top","10px",3,"formGroupName"],[1,"flex-container"],[1,"col-10",2,"min-height","200px"],["type","text","id","paragraph","formControlName","paragraph",1,"form-control"],[1,"delete","col-1"],["type","button",1,"btn","btn-light",3,"click"],["id","boot-icon",1,"bi","bi-trash",2,"color","rgb(255, 0, 0)"]],template:function(t,i){if(1&t){const s=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"form",2),e.NdJ("ngSubmit",function(){return i.onSubmit()}),e.TgZ(3,"div",0)(4,"div",1)(5,"button",3),e._uU(6," Save "),e.qZA(),e.TgZ(7,"button",4),e.NdJ("click",function(){return i.onCancel()}),e._uU(8," Cancel "),e.qZA(),e.TgZ(9,"button",4),e.NdJ("click",function(){return i.onDelete()}),e._uU(10," Delete "),e.qZA()()(),e.TgZ(11,"div",5)(12,"label",6),e._uU(13,"Header Logo"),e.qZA(),e.TgZ(14,"div",0),e.YNc(15,U,5,3,"div",7),e.qZA()(),e.TgZ(16,"div")(17,"button",8),e.NdJ("click",function(){e.CHM(s);const n=e.MAs(22);return n.value="",e.KtG(n.click())}),e._uU(18," Browse "),e.qZA(),e.TgZ(19,"span"),e._uU(20),e.qZA()(),e.TgZ(21,"input",9,10),e.NdJ("change",function(n){return i.uploadCultureFile(n,!0)}),e.qZA(),e.TgZ(23,"div",0)(24,"div",1)(25,"div",11)(26,"label",12),e._uU(27,"Header"),e.qZA(),e._UZ(28,"input",13),e.qZA()()(),e.TgZ(29,"div",0)(30,"div",14)(31,"label",15),e._uU(32,"Sequence"),e.qZA()(),e.TgZ(33,"div",16)(34,"select",17),e.NdJ("change",function(n){return i.changeSeq(n)}),e.YNc(35,N,2,2,"option",18),e.qZA()(),e.YNc(36,J,4,0,"div",19),e.qZA(),e.TgZ(37,"div",20)(38,"label",21),e._uU(39,"Images"),e.qZA(),e.TgZ(40,"div",0),e.YNc(41,O,5,3,"div",7),e.qZA()(),e.TgZ(42,"div")(43,"button",8),e.NdJ("click",function(){e.CHM(s);const n=e.MAs(48);return n.value="",e.KtG(n.click())}),e._uU(44," Browse "),e.qZA(),e.TgZ(45,"span"),e._uU(46),e.qZA()(),e.TgZ(47,"input",22,23),e.NdJ("change",function(n){return i.uploadCultureFile(n,!1)}),e.qZA(),e.TgZ(49,"div",0)(50,"div",24)(51,"label",25),e._uU(52,"Description"),e.qZA(),e.YNc(53,k,8,1,"div",26),e.TgZ(54,"div",0)(55,"div",1)(56,"button",27),e.NdJ("click",function(){return i.onAddParagraph()}),e._uU(57," Add Paragraph "),e.qZA()()()()()()()()}2&t&&(e.xp6(2),e.Q6J("formGroup",i.cultureForm),e.xp6(3),e.Q6J("disabled",!i.cultureForm.valid),e.xp6(10),e.Q6J("ngForOf",i.headerImageControls),e.xp6(5),e.AsE(" ",i.headerImgLst.length," files have been uploaded ( ",i.headerImg," ) "),e.xp6(1),e.Q6J("hidden",!0),e.xp6(14),e.Q6J("ngForOf",i.culture),e.xp6(1),e.Q6J("ngIf",null==i.seq.errors?null:i.seq.errors.required),e.xp6(5),e.Q6J("ngForOf",i.imagesControls),e.xp6(5),e.AsE(" ",i.imageList.length," files have been uploaded ( ",i.image," ) "),e.xp6(1),e.Q6J("hidden",!0),e.xp6(6),e.Q6J("ngForOf",i.descriptionsControls))},dependencies:[d.sg,d.O5,l._Y,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.JL,l.sg,l.u,l.x0,l.CE],styles:[".row[_ngcontent-%COMP%]{margin-bottom:10px}.container[_ngcontent-%COMP%]{margin-bottom:30px}.flex-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.delete[_ngcontent-%COMP%]{display:inline-block;margin:100px 10px}textarea[_ngcontent-%COMP%]{width:100%;height:100%}.col-12[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:20px}"]}),r})();var q=a(5087);function E(r,o){if(1&r&&(e.TgZ(0,"div",8),e._UZ(1,"img",9),e.TgZ(2,"p",10),e._uU(3),e.qZA()()),2&r){const t=o.$implicit,i=e.oxw();e.xp6(1),e.s9C("alt",t.name),e.Q6J("src",t.url,e.LSH),e.xp6(2),e.Oqu(i.culture.header)}}function M(r,o){if(1&r&&(e.TgZ(0,"div",11),e._UZ(1,"img",12),e.qZA()),2&r){const t=o.$implicit;e.xp6(1),e.s9C("alt",t.name),e.Q6J("src",t.url,e.LSH)}}function P(r,o){if(1&r&&(e.TgZ(0,"p",13),e._uU(1),e.qZA()),2&r){const t=o.$implicit;e.xp6(1),e.hij(" ",t.paragraph," ")}}const Q=function(r){return[r]};let D=(()=>{class r{constructor(t){this.authService=t,this.user=null}ngOnInit(){this.user=null,this.user=this.authService.getCurrentUser(),console.log(this.user)}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(q.e))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-culture-detail"]],inputs:{culture:"culture"},decls:9,vars:8,consts:[["routerLinkActive","active",1,"list-group-item","clearfix",3,"routerLink"],[1,"container-fluid"],[1,"row"],["class","header-img",4,"ngFor","ngForOf"],[1,"col-xl-3","col-lg-3","col-md-3"],["style","margin-bottom: 10px;",4,"ngFor","ngForOf"],[1,"col-xl-6","col-lg-6","col-md-6"],["class","text-justify",4,"ngFor","ngForOf"],[1,"header-img"],[3,"src","alt"],[1,"header-text"],[2,"margin-bottom","10px"],[1,"img-responsive",3,"src","alt"],[1,"text-justify"]],template:function(t,i){1&t&&(e.TgZ(0,"a",0)(1,"div",1)(2,"div",2),e.YNc(3,E,4,3,"div",3),e.qZA(),e.TgZ(4,"div",2)(5,"div",4),e.YNc(6,M,2,2,"div",5),e.qZA(),e.TgZ(7,"div",6),e.YNc(8,P,2,1,"p",7),e.qZA()()()()),2&t&&(e.ekj("disabled",null==i.user),e.Q6J("routerLink",e.VKq(6,Q,i.culture.key)),e.xp6(3),e.Q6J("ngForOf",i.culture.headerImage),e.xp6(3),e.Q6J("ngForOf",i.culture.images),e.xp6(2),e.Q6J("ngForOf",i.culture.description))},dependencies:[d.sg,c.rH,c.Od],styles:["a[_ngcontent-%COMP%]{margin-bottom:20px;cursor:pointer}a.disabled[_ngcontent-%COMP%]{pointer-events:none;cursor:not-allowed}img[_ngcontent-%COMP%]{max-width:100%;height:auto}.header-text[_ngcontent-%COMP%]{display:inline-block;width:-moz-fit-content;width:fit-content;margin:0 auto;padding:1em;font-size:20px;text-align:left;font-weight:700}.header-img[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;height:auto;min-height:70px}"]}),r})();function Y(r,o){if(1&r){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"button",4),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.onNewCulture())}),e._uU(3,"New Culture"),e.qZA()()()}}function j(r,o){1&r&&e._UZ(0,"app-culture-detail",5),2&r&&e.Q6J("culture",o.$implicit)}let T=(()=>{class r{constructor(t,i,s,u){this.cultureService=t,this.router=i,this.route=s,this.authService=u,this.user=null}ngOnDestroy(){this.subscription.unsubscribe()}ngOnInit(){this.retrieveCulture()}retrieveCulture(){this.subscription=this.cultureService.getAll().snapshotChanges().pipe((0,m.U)(t=>t.map(i=>({key:i.payload.key,...i.payload.val()})))).subscribe(t=>{t.sort((i,s)=>i.seq.localeCompare(s.seq)),this.cultures=t,this.user=this.authService.getCurrentUser(),console.log(this.user)})}onNewCulture(){this.router.navigate(["new"],{relativeTo:this.route})}}return r.\u0275fac=function(t){return new(t||r)(e.Y36(F),e.Y36(c.F0),e.Y36(c.gz),e.Y36(q.e))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-culture-list"]],decls:4,vars:2,consts:[["class","row",4,"ngIf"],[1,"row"],[1,"col-12"],[3,"culture",4,"ngFor","ngForOf"],[1,"btn","btn-success",3,"click"],[3,"culture"]],template:function(t,i){1&t&&(e.YNc(0,Y,4,0,"div",0),e.TgZ(1,"div",1)(2,"div",2),e.YNc(3,j,1,1,"app-culture-detail",3),e.qZA()()),2&t&&(e.Q6J("ngIf",null!=i.user),e.xp6(3),e.Q6J("ngForOf",i.cultures))},dependencies:[d.sg,d.O5,D]}),r})();var y=a(9363);const G=[{path:"list",component:T},{path:"list/new",component:Z,canActivate:[y.a]},{path:"list/:id",component:Z,canActivate:[y.a]},{path:"",component:T}];let H=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[d.ez,l.u5,c.Bz.forChild(G),A.m]}),r})()}}]);